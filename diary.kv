#:set C_BG (0.05, 0.066, 0.09, 1)
#:set C_SURFACE (0.086, 0.105, 0.133, 1)
#:set C_BORDER (0.188, 0.211, 0.239, 1)
#:set C_ACCENT (0.345, 0.651, 1.0, 1)
#:set C_TEXT_MAIN (0.788, 0.82, 0.851, 1)
#:set C_TEXT_SEC (0.545, 0.58, 0.62, 1)
#:set C_BTN_OK (0.137, 0.525, 0.211, 1)

#:import DampedScrollEffect kivy.effects.dampedscroll.DampedScrollEffect
#:import SwipeBox widgets.SwipeBox
#:import DiaryEntryItemCard widgets.DiaryEntryItemCard
#:import WindowManager screens.WindowManager
#:import HomeScreen screens.HomeScreen
#:import DiaryScreen screens.DiaryScreen
#:import DetailScreen screens.DetailScreen
#:import DayPage screens.DayPage

<FlatButton@Button>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    color: 1, 1, 1, 1
    font_size: '16sp'
    bold: True
    canvas.before:
        Color:
            rgba: C_BTN_OK if self.state == 'normal' else (0.16, 0.58, 0.24, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [6]
        Color:
            rgba: (1, 1, 1, 0.1)
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, 6)
            width: 1

<GhostButton@Button>:
    background_color: 0, 0, 0, 0
    background_normal: ''
    color: C_ACCENT
    font_size: '16sp'
    canvas.before:
        Color:
            rgba: (0.1, 0.1, 0.1, 0) # Transparent usually
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [6]

WindowManager:
    HomeScreen:
    DiaryScreen:
    DetailScreen:

<HomeScreen>:
    name: "home"
    
    BoxLayout:
        orientation: "vertical"
        padding: 40
        spacing: 0
        canvas.before:
            Color:
                rgba: C_BG
            Rectangle:
                pos: self.pos
                size: self.size
            # GitHub Activity Grid aesthetic (dots)
            Color:
                rgba: (0.1, 0.3, 0.1, 0.2)
            Ellipse:
                pos: (root.width * 0.7, root.height * 0.8)
                size: (100, 100)
            Ellipse:
                pos: (root.width * 0.1, root.height * 0.5)
                size: (40, 40)

        Widget:
            size_hint_y: 0.3

        Label:
            text: "git commit -m\\n'my day'"
            font_size: '42sp'
            font_name: 'Roboto' # Monospace would be cool but keep roboto for clean
            # bold: True
            color: C_TEXT_MAIN
            size_hint_y: None
            height: self.texture_size[1]
            halign: 'left'
            text_size: (root.width - 80, None)
            id: title_label
            opacity: 0

        Label:
            text: "Push your daily updates."
            font_size: '18sp'
            color: C_TEXT_SEC
            size_hint_y: None
            height: self.texture_size[1]
            halign: 'left'
            text_size: (root.width - 80, None)
            padding: [0, 20]
            id: subtitle_label
            opacity: 0

        Widget: 
            size_hint_y: 0.2

        FlatButton:
            text: "Start Log"
            size_hint: (None, None)
            size: (200, 50)
            pos_hint: {"center_x": 0.5}
            id: start_btn
            opacity: 0
            on_release: 
                app.root.current = "diary"
                app.root.transition.direction = "left"

        Widget:
            size_hint_y: 0.3

<DiaryScreen>:
    name: "diary"
    on_enter: root.init_view()

    SwipeBox:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: C_BG
            Rectangle:
                pos: self.pos
                size: self.size

        # Header
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            padding: [15, 0]
            spacing: 0
            canvas.before:
                Color:
                    rgba: C_SURFACE
                Rectangle:
                    pos: self.pos
                    size: self.size
                # Bottom Border
                Color:
                    rgba: C_BORDER
                Line:
                    points: [self.x, self.y, self.width, self.y]
                    width: 1

            BoxLayout:
                orientation: "vertical"
                size_hint_x: 0.7
                padding: [0, 8]
                
                Label:
                    text: root.current_date_display_day
                    font_size: '11sp'
                    color: C_TEXT_SEC
                    bold: True
                    halign: 'left'
                    text_size: self.size
                    valign: 'bottom'
                
                Label:
                    text: root.current_date_display_date
                    font_size: '20sp'
                    bold: True
                    color: C_TEXT_MAIN
                    halign: 'left'
                    text_size: self.size
                    valign: 'top'

            GhostButton:
                text: "Home"
                size_hint_x: None
                width: '80dp'
                font_size: '14sp'
                color: C_ACCENT
                on_release: 
                    app.root.current = "home"
                    app.root.transition.direction = "right"

        # Content
        ScreenManager:
            id: day_manager

<DayPage>:
    BoxLayout:
        ScrollView:
            id: scroll_view
            do_scroll_x: False
            bar_width: 0
            effect_cls: DampedScrollEffect
            
            GridLayout:
                id: grid_layout
                cols: 2
                spacing: 12
                padding: [15, 15, 15, 40]
                size_hint_y: None
                height: self.minimum_height

<DiaryEntryItemCard>:
    orientation: "vertical"
    size_hint_y: None
    height: 160
    padding: 15
    spacing: 10
    opacity: 1
    
    canvas.before:
        # Card Body
        Color:
            rgba: C_SURFACE
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [6]
        # Border
        Color:
            rgba: C_BORDER
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, 6)
            width: 1

    Label:
        text: root.question
        text_size: self.size
        halign: 'left'
        valign: 'top'
        color: C_TEXT_MAIN
        font_size: '13sp'
        bold: True
        size_hint_y: 0.35

    Label:
        text: root.answer if root.answer else "No content provided."
        text_size: self.size
        valign: 'top'
        halign: 'left'
        color: C_TEXT_SEC
        font_size: '12sp'
        line_height: 1.2
        size_hint_y: 0.65

<DetailScreen>:
    name: "detail"
    
    BoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: C_BG
            Rectangle:
                pos: self.pos
                size: self.size
        
        # Header
        BoxLayout:
            size_hint_y: None
            height: '60dp'
            padding: [15, 0]
            canvas.before:
                Color:
                    rgba: C_SURFACE
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: C_BORDER
                Line:
                    points: [self.x, self.y, self.width, self.y]
                    width: 1
            
            GhostButton:
                text: "Back"
                size_hint_x: None
                width: '60dp'
                halign: 'left'
                color: C_TEXT_SEC
                on_release: root.save_and_close()

            Label:
                text: "Edit File"
                halign: 'center'
                valign: 'middle'
                color: C_TEXT_MAIN
                bold: True
                font_size: '16sp'

            GhostButton:
                text: "Commit"
                size_hint_x: None
                width: '70dp'
                color: C_BTN_OK
                bold: True
                on_release: root.save_and_close()
        
        ScrollView:
            BoxLayout:
                orientation: "vertical"
                padding: [20, 20, 20, 40]
                size_hint_y: None
                height: self.minimum_height
                spacing: 20

                Label:
                    text: root.question
                    text_size: (root.width - 40, None)
                    size_hint_y: None
                    height: self.texture_size[1]
                    halign: 'left'
                    color: C_TEXT_MAIN
                    font_size: '20sp'
                    bold: True
                    line_height: 1.2

                # Input container mimicking a code block
                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: max(detail_input.minimum_height + 40, 300)
                    canvas.before:
                        Color:
                            rgba: C_SURFACE
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [6]
                        Color:
                            rgba: C_BORDER
                        Line:
                            rounded_rectangle: (self.x, self.y, self.width, self.height, 6)
                            width: 1

                    TextInput:
                        id: detail_input
                        text: root.answer
                        hint_text: "Type your code... I mean, thoughts."
                        hint_text_color: C_TEXT_SEC
                        multiline: True
                        background_color: 0, 0, 0, 0
                        foreground_color: C_TEXT_MAIN
                        cursor_color: C_ACCENT
                        font_size: '14sp'
                        font_name: 'Roboto' # or Courier if available?
                        line_height: 1.5
                        size_hint_y: 1
                        padding: [15, 15]
